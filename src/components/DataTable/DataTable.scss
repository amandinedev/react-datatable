@use '../../sass/abstracts' as *;
@use "sass:color";


// ============================================================================
// DATA TABLE BASE STYLES
// ============================================================================

.data-table {
  font-family: $dt-font-family;
  font-size: $dt-font-size;
  line-height: $dt-line-height;
  color: $dt-text-color;
  background: $dt-bg-color;
  border-radius: $dt-border-radius;
  box-shadow: $dt-box-shadow;
  overflow: hidden;
  transition: all $dt-transition-speed $dt-transition-timing;
  width: 100%;

  // Loading state
  &.loading {
    min-height: $dt-table-loading-height;
    @include dt-flex-center;
    @include dt-flex-column;
    gap: $dt-pagination-gap;

    .loading-spinner {
      width: $dt-spinner-size;
      height: $dt-spinner-size;
      border: $dt-spinner-border-width solid $dt-spinner-border-color;
      border-top-color: $dt-spinner-border-active-color;
      border-radius: 50%;
      @include dt-loading-animation;
    }

    p {
      margin: 0;
      color: $dt-text-color;
      font-weight: $dt-font-weight-semibold;
    }
  }
}

// ============================================================================
// TABLE CONTROLS
// ============================================================================

.table-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: $dt-controls-padding;
  border-bottom: 1px solid $dt-border-color;
  gap: $dt-page-selector-gap;
  flex-wrap: wrap;

  @include dt-media(mobile) {
    padding: $dt-controls-padding-sm;
    flex-direction: column;
    align-items: stretch;
    gap: $dt-page-selector-gap-sm;
  }

  .pagination-controls {
    flex-shrink: 0;
  }

  .search-control {
    flex: 1;
    min-width: 200px;

    @include dt-media(mobile) {
      min-width: 100%;
    }
  }
}

// ============================================================================
// TABLE WRAPPER
// ============================================================================

.table-wrapper {
  overflow-x: auto;
  min-height: $dt-table-min-height;
  @include dt-custom-scrollbar;
}

// ============================================================================
// TABLE STRUCTURE
// ============================================================================

table {
  width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  background: $dt-bg-color;

  // Table header
  thead {
    background: $dt-header-bg;
    border-bottom: 2px solid $dt-border-color;

    tr {
      th {
        padding: $dt-padding;
        text-align: left;
        font-weight: $dt-font-weight-semibold;
        position: relative;
        user-select: none;
        border-right: 1px solid $dt-border-color;
        background: $dt-header-bg; // Explicit header cell background

        &:last-child {
          border-right: none;
        }

        &.sortable {
          cursor: pointer;
          transition: background-color $dt-transition-speed $dt-transition-timing;

          &:hover,
          &:focus {
            background: color.scale($dt-hover-color, $lightness: -10%);
          }

          &:focus {
            @include dt-focus-outline;
            z-index: 1;
          }

          .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
          }

          .sort-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: $dt-table-sort-indicator-size + 8px;
            height: $dt-table-sort-indicator-size + 4px;
            flex-shrink: 0;
          }

          .sort-arrow-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 2px 0;
          }

          .sort-arrow-up,
          .sort-arrow-down {
            font-size: 10px;
            line-height: 1;
            color: color.scale($dt-text-color, $lightness: 40%);
            opacity: 0.5;
            transition: all $dt-transition-speed $dt-transition-timing;
            display: block;
            
            &.active {
              color: $dt-primary-color;
              opacity: 1;
            }
          }

          &:hover {
            .sort-arrow-up:not(.active),
            .sort-arrow-down:not(.active) {
              opacity: 0.8;
            }
          }

          &.sorted {
            .sort-arrow-up:not(.active),
            .sort-arrow-down:not(.active) {
              opacity: 0;
            }
          }

          &:not(.sorted) {
            .sort-arrow-up,
            .sort-arrow-down {
              opacity: 0.3;
                   
              
              &:hover {
                opacity: 0.8;
                     
              }
            }
          }
        }

        &:not(.sortable) {
          .header-content {
            display: block;
          }
        }
      }
    }
  }

  // Table body
  tbody {
    background: $dt-bg-color;

    tr {
      height: $dt-table-row-height;
      transition: background-color $dt-transition-speed $dt-transition-timing;
      background: $dt-bg-color; // Explicit row background

      &:hover {
        background: color.scale($dt-hover-color, $lightness: -20%) !important;
      }

      &.clickable {
        cursor: pointer;

        &:hover {
          background: color.scale($dt-hover-color, $lightness: -30%) !important;
        }
      }

      // Striped rows
      .data-table.striped & {
        &:nth-child(even) {
          background: color.scale($dt-hover-color, $lightness: 5%);

          &:hover {
            background: color.scale($dt-hover-color, $lightness: -15%) !important;
          }
        }

        &:nth-child(odd) {
          background: $dt-bg-color;

          &:hover {
            background: color.scale($dt-hover-color, $lightness: -20%) !important;
          }
        }
      }

      td {
        padding: $dt-padding;
        border-bottom: 1px solid $dt-border-color;
        border-right: 1px solid $dt-border-color;
        background: inherit; // Inherit background from parent tr

        &:last-child {
          border-right: none;
        }
      }

      &:last-child {
        td {
          border-bottom: none;
        }
      }
    }

    // Empty state
    .empty-row {
      height: $dt-table-loading-height;
      background: $dt-bg-color;

      td {
        background: $dt-bg-color;
        text-align: center;
        padding: $dt-controls-padding;
        border: none;
      }

      .empty-state {
        @include dt-flex-center;
        @include dt-flex-column;
        gap: $dt-pagination-gap;

        .empty-icon {
          font-size: $dt-table-empty-icon-size;
          opacity: 0.5;
        }

        p {
          margin: 0;
          color: $dt-text-color;
          font-size: $dt-font-size-lg;
          font-weight: $dt-font-weight-semibold;
        }

        .empty-subtext {
          font-size: $dt-font-size;
          font-weight: $dt-font-weight-normal;
          color: $dt-placeholder-color;
        }
      }
    }
  }
}

// ============================================================================
// TABLE FOOTER
// ============================================================================

.table-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: $dt-controls-padding;
  border-top: 1px solid $dt-border-color;
  flex-wrap: wrap;
  gap: $dt-pagination-gap;

  @include dt-media(mobile) {
    padding: $dt-controls-padding-sm;
    flex-direction: column;
    align-items: stretch;
    text-align: center;
    gap: $dt-pagination-gap-sm;
  }

  .footer-left,
  .footer-right {
    flex-shrink: 0;
  }

  .footer-left {
    @include dt-media(mobile) {
      order: 2;
    }
  }

  .footer-right {
    @include dt-media(mobile) {
      order: 1;
    }
  }
}

// ============================================================================
// DARK THEME
// ============================================================================

.data-table.dark-theme {
  background: $dt-dark-bg;
  color: $dt-dark-text;

  .table-controls,
  .table-footer {
    border-color: $dt-dark-border;
    background: $dt-dark-header;
  }

  // Explicitly target the table and all its cells
  .table-wrapper {
    table {
      background: $dt-dark-bg;
      
      // Table header in dark theme
      thead {
        background: $dt-dark-header;
        border-bottom-color: $dt-dark-border;

        tr {
          th {
            border-right-color: $dt-dark-border;
            color: #FFFFFF;
            font-weight: $dt-font-weight-semibold;
            background: $dt-dark-header !important; // Force dark header

            &.sortable {
              &:hover,
              &:focus {
                background: color.scale($dt-dark-header, $lightness: 10%) !important;
              }

              .sort-arrow-up,
              .sort-arrow-down {
                color: rgba(255, 255, 255, 0.6);

                &.active {
                  color: $dt-primary-color-light;
                }
              }
            }
          }
        }
      }

      // Table body in dark theme
      tbody {
        background: $dt-dark-bg !important;

        tr {
          height: $dt-table-row-height;
          background: $dt-dark-cell-bg !important; // DARK GREY CELLS - FORCE IT

          &:hover {
            background: color.scale($dt-dark-cell-bg, $lightness: 8%) !important;
          }

          &.clickable {
            &:hover {
              background: color.scale($dt-dark-cell-bg, $lightness: 12%) !important;
            }
          }

          // Striped rows for dark theme
          &.even,
          &:nth-child(even) {
            background: $dt-dark-cell-striped !important;

            &:hover {
              background: color.scale($dt-dark-cell-striped, $lightness: 8%) !important;
            }
          }

          &.odd,
          &:nth-child(odd) {
            background: $dt-dark-cell-bg !important;

            &:hover {
              background: color.scale($dt-dark-cell-bg, $lightness: 20%) !important;
            }
          }

          // Apply to ALL table cells
          td {
            border-color: $dt-dark-border !important;
            color: $dt-dark-text !important;
            background: inherit !important; // Inherit from parent row
          }

          &:last-child {
            td {
              border-bottom-color: $dt-dark-border !important;
            }
          }
        }

        // Empty row
        .empty-row {
          background: $dt-dark-bg !important;

          td {
            background: $dt-dark-bg !important;
            border: none !important;
          }

          .empty-state {
            .empty-icon {
              color: $dt-dark-text;
            }

            p {
              color: $dt-dark-text;
            }

            .empty-subtext {
              color: $dt-dark-placeholder;
            }
          }
        }
      }
    }
  }

  // Loading state
  &.loading {
    .loading-spinner {
      border-color: $dt-dark-border;
      border-top-color: $dt-primary-color-light;
    }

    p {
      color: $dt-dark-text;
    }
  }
}

// ============================================================================
// ACCESSIBILITY & REDUCED MOTION
// ============================================================================

@media (prefers-reduced-motion: reduce) {
  .data-table,
  table tbody tr,
  th.sortable {
    transition: none;
  }

  .loading-spinner {
    animation-duration: 2s;
  }
}

// ============================================================================
// PRINT STYLES
// ============================================================================

@media print {
  .data-table {
    box-shadow: none;
    border: 1px solid #000;

    .table-controls,
    .table-footer {
      display: none;
    }

    .table-wrapper {
      overflow: visible;
    }

    table {
      page-break-inside: avoid;

      thead {
        display: table-header-group;
      }

      tbody tr {
        page-break-inside: avoid;
        page-break-after: auto;
      }
    }
  }
}